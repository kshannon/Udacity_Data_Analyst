---
title: "What makes wine taste good or bad?"
author: "Kyle Shannon"
date: "June 23, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, echo=FALSE}
library(ggplot2) #must load the ggplot package first
library(ggthemes)
library(dplyr)
library(gridExtra)
library(reshape2)
```

```{r Load wine data, echo=FALSE}
# Load the Data
wine_data <‐ read.csv('wineQualityReds.csv', header = T)
# Dropping X column - It's just an identifier
wine_data <‐ subset(wine_data, select = ‐ X)
```

```{r Function to calculate Mode, echo=FALSE}
# To find the Mode of a vector/ list
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
```

## Abstract
Exploratory Data Analysis (EDA) on a complete data set with 12 variables and 1599 observations. This data set is about Red Wine and includes both chemically measured (11 variables) properties of the wine and 1 sensory measured quality of the wine. The sensory measurement was a rating given by wine experts on a 10 point scale (1 = worst, 10 = best) about the quality of the wine. The goal of this exploratory analysis is to get a better understanding of the underlying data, the chmical properties that make up the wine and how they may impact the quality. 

A guiding question would be: Are their any trends in the data to suggest that certain chemical properties influence a wine's quality rating?



## Introduction
To begin I will start by plotting univariate data plots. i want to get a feel for each feature in the data set and look at the variance of the data. Are there any outlandish outliers? Are there trends in each variable, i.e. 25% of one variable is a 0.00 or some other discrete value. Also what are the distributions of data? Is there many skewed distributions? Or perhaps bimodal distributions. Capturing this along with a summary (quartiles, median, mean, mode) of each feature is my starting point. 

I will then go into creating new features and bivariate analysis looking at correlation between the features. I am especially if any features correlate with quality. If so why is that and what is that interaction.

Finally  Iwill take all I have learned and being to look at multivariate data. I am especially interested to see if there are any correlated features that show interesting spreads of wine quality.

## Basic Overall Exploration
```{r wine summary, echo=FALSE}
#summarize wine_data
summary(wine_data)
str(wine_data)
```

The above summary(data) and str(data) provides an overall view of the data types, Min/ Max, Mean/ Median and the quartiles. I get a sense that a lot of the data is skewed, i.e. "total.sulfur.dioxide" Let's start with some simple histogram plots of each variable, along with a summary of the variable.


## Variable Distributions - Univariate Analysis

### Fixed Acidity Hist/ Summary:
```{r fixed.acidity distro/ summary, echo=FALSE}
ggplot(aes(x = fixed.acidity), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$fixed.acidity), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$fixed.acidity), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$fixed.acidity), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.10, colour="black") +
  labs(title = "Fixed Acidity Distribution", x = "Fixed Acidity") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$fixed.acidity)
paste("Mode: ", Mode(wine_data$fixed.acidity))
```
Fixed Acidity (tartaric acids) has a right skew favoring slightly higher acidity.

### Volatile Acidity Hist/ Summary:
```{r volatile.acidity distro/ summary, echo=FALSE}
ggplot(aes(x = volatile.acidity), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$volatile.acidity), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$volatile.acidity), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$volatile.acidity), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.01, colour="black") +
  labs(title = "Volatile Acidity Distribution", x = "Volatile Acidity") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$volatile.acidity)
paste("Mode: ", Mode(wine_data$volatile.acidity))

# removed some skewed data to get a better picture of the distribution.
ggplot(aes(x = volatile.acidity), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$volatile.acidity), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$volatile.acidity), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$volatile.acidity), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.01, colour="black") +
  labs(title = "Volatile Acidity Distribution", x = "Volatile Acidity") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  scale_x_continuous(limits = c(quantile(wine_data$volatile.acidity, 0.01),
                                quantile(wine_data$volatile.acidity, 0.99)),
                     breaks = seq(0.25, 1, 0.1))+
  theme_bw()

```
Volatile Acidity (acetic acid in the wine) appears to have a slight bimodal distribution with a right-handed skew. A quick look at the data table shows that the highest volatile acidic rating (1.58) has the lowest quality rating in the data set (3). The lowest volatile rating (.120) has the 2nd highest score for quality (7). A cursory glance at the lowest and highest volatile numbers follow suite with higher and lower quality ratings. This will certainly be an interesting feature that might be able to help predict red wine quality and will require further exploration.

### Citric Acid Hist/ Summary:
```{r citric.acid distro/ summary, echo=FALSE}
ggplot(aes(x = citric.acid), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$citric.acid), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$citric.acid), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$citric.acid), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.01, colour="black") +
  labs(title = "Citric Acid Distribution", x = "Citric Acid") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$citric.acid)
paste("Mode: ", Mode(wine_data$citric.acid))
```
Citric Acid can add freshness and flavor to the wine. A quick look at the raw data showed that both wines that were rated as good (~6) had both 0 citri acid present and a hightened amount (~0.75). Perhaps presence of citric acid can not harm the wine, but can potentially improve its freshness? However the potential outlier of 1.00 citric acid did hav a lower quality rating (4). This will be interesting to explore further. Another interesting observation is that so many wines have a citric acid value of 0.49. This seems odd for so many wines to have this exact value. The fact that there are so many 0.00 citric acid reading could be more plausible if those wines were made with some different ingrediants or with a different process. 

### Residual Sugar Hist/ Summary:
```{r residual.sugar distro/ summary, echo=FALSE}
ggplot(aes(x = residual.sugar), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$residual.sugar), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$residual.sugar), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$residual.sugar), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.1, colour="black") +
  labs(title = "Residual Sugar Distribution", x = "Residual Sugar") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$residual.sugar)
paste("Mode: ", Mode(wine_data$residual.sugar))
```
Residual Sugar is the remaining sugar after fermentation stops. Wines with more than 45 g / dm^3 are considered sweet. We have no "sweet" wines in our data. Wines with less than 1.00 g / dm^3 are consiered rare. We have only two of those wines, both at 0.9. Therefore our wine list is not skewed by wines with rare residual sugar readings or sweet wines. Most of the wines in this data set are under 4 g / dm^3. It looks fairly normally distributed, except for the right handed skewness. 

### Chlorides Hist/ Summary:
```{r Chlorides distro/ summary, echo=FALSE}
ggplot(aes(x = chlorides), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$chlorides), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$chlorides), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$chlorides), color="Mode"), size=1) +
  geom_histogram(binwidth = 0.005, colour="black") +
  labs(title = "Chlorides Distribution", x = "Chlorides") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$chlorides)
paste("Mode: ", Mode(wine_data$chlorides))
```
Chlorides data is the amount of salt in the wine. Looks normally distrtibuted, except for some right handed skewness. Smome potential outliers may be present as well. It looks like there may be a slight negative correlation between the amount of chlorides and quality. This will be looked into when we start looking at variable interactions.

### Free Sulfur Dioxide Hist/ Summary:
```{r free.sulfur.dioxide/ summary, echo=FALSE}
ggplot(aes(x = free.sulfur.dioxide), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$free.sulfur.dioxide), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$free.sulfur.dioxide), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$free.sulfur.dioxide), color="Mode"), size=1) +
  geom_histogram(binwidth = 1, colour="black") +
  labs(title = "Free Sulfur Dioxide Distribution", x = "Free Sulfur Dioxide") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$free.sulfur.dioxide)
paste("Mode: ", Mode(wine_data$free.sulfur.dioxide))
```
Free Sulfar Dioxide prevents microbial growth and the oxidation of wine. I would suspect that there may be an optimal range for sulfur dioxide as a preservative, but too much may taint the taste and too little may not provide the wine enough protection. The distribution of dioxides is heavily righthanded skewed. From a cursory glance there does not seem to be a difference in the quality between low, medium and high number of dioxides.

### Total Sulfur Dioxide Hist/ Summary:
```{r total.sulfur.dioxide/ summary, echo=FALSE}
ggplot(aes(x = total.sulfur.dioxide), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$total.sulfur.dioxide), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$total.sulfur.dioxide), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$total.sulfur.dioxide), color="Mode"), size=1) +
  geom_histogram(binwidth = 2, colour="black") +
  labs(title = "Total Sulfur Dioxide Distribution", x = "Total Sulfur Dioxide") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$total.sulfur.dioxide)
paste("Mode: ", Mode(wine_data$total.sulfur.dioxide))
```
Total sulfur dioxide below 50 ppm is mostly undetectable. This data is highly skewed right. 

### Density Hist/ Summary:
```{r density/ summary, echo=FALSE}
ggplot(aes(x = density), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$density), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$density), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$density), color="Mode"), size=1) +
  geom_histogram(binwidth = .0001, colour="black") +
  labs(title = "density", x = "density") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$density)
paste("Mode: ", Mode(wine_data$density))
```
Density is close to H2O depending in the amount of sugar and alcohol present. This data looks fairly normally distributed.

### pH Hist/ Summary:
```{r pH/ summary, echo=FALSE}
ggplot(aes(x = pH), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$pH), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$pH), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$pH), color="Mode"), size=1) +
  geom_histogram(binwidth = .01, colour="black") +
  labs(title = "pH", x = "pH") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$pH)
paste("Mode: ", Mode(wine_data$pH))
```
pH describes the acidity of the wine. This data seems normally distributed.

### Sulphates Hist/ Summary:
```{r Sulphates/ summary, echo=FALSE}
ggplot(aes(x = sulphates), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$sulphates), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$sulphates), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$sulphates), color="Mode"), size=1) +
  geom_histogram(binwidth = .02, colour="black") +
  labs(title = "Sulphates", x = "Sulphates") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$sulphates)
paste("Mode: ", Mode(wine_data$sulphates))
```
Sulphates contribute to SO2. These are probably correlated. Suplhates data is slightly right handed skewed. Some outliers perhaps.

### Alcohol Hist/ Summary:
```{r Alcohol/ summary, echo=FALSE}
ggplot(aes(x = alcohol), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$alcohol), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$alcohol), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$alcohol), color="Mode"), size=1) +
  geom_histogram(binwidth = .1, colour="black") +
  labs(title = "Alcohol", x = "Alcohol") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$alcohol)
paste("Mode: ", Mode(wine_data$alcohol))
```
Alcohol data represents the % of alchohol in wine. Heavy right handed skewness. Cursory view seems to suggest that alcohol has a positive correlation with quality.

### Quality Hist/ Summary:
```{r quality/ summary, echo=FALSE}
ggplot(aes(x = quality), data = wine_data) +
  geom_vline(aes(xintercept=mean(wine_data$quality), color="Mean"), size=1) +
  geom_vline(aes(xintercept=median(wine_data$quality), color="Median"), size=1) +
  geom_vline(aes(xintercept=Mode(wine_data$quality), color="Mode"), size=1) +
  geom_histogram(binwidth = 1, colour="black") +
  labs(title = "Quality", x = "Quality") +
  scale_colour_manual(name="Line Color",
    values=c(Median="orange", Mean="blue", Mode="purple")) +
  theme_bw()

summary(wine_data$quality)
paste("Mode: ", Mode(wine_data$quality))
```
Quality is on a 10 point scale (1=worst, 10=best) In this data set the values fall between 3 - 8. Most scores were 5 and 6. Most wines were  subjectively ok. Very few wines were rated either 3 or 8.

### Feature Engineering
I wanted to see how pH and acids correlate to each other and if quality can be partly explained by these interactions. I know that pH id dependant on acids and bases. I also know citric acid can be thought of as good, while volatile acid can be thought of as bad. But lrt's create a new feature called total.acids. I believe this should be a combination of all three acid features.

```{r Totoal.acids summary, echo=FALSE}
wine_data$total.acids <‐ with(wine_data, fixed.acidity + volatile.acidity + citric.acid)

p1 <- qplot(x = fixed.acidity,  data = wine_data) + geom_histogram(binwidth = 0.1)
p2 <- qplot(x = volatile.acidity, data = wine_data) + geom_histogram(binwidth = 0.01)
p3 <- qplot(x = citric.acid, data = wine_data) + geom_histogram(binwidth = 0.02)
p4 <- qplot(x = total.acids, data = wine_data) + geom_histogram(binwidth = 0.1)

grid.arrange(p1, p2, p3, p4, ncol = 1)
```

This might not be too helpful. As citric and volatile acids make up such a small % of fixed acidity. You can see how the distribution of volatile and citric acid are completely different from total and fixed. Ttoal and fixed look almost identical.

## Bivariate Analysis
I want to switch gears and begin to look at how two variables interact and how each feature is correlated. Lets reaxamine the acids and quality as a 2nd variable.

```{r Totoal.acids with quality, echo=FALSE}

ggplot(aes(x = total.acids, color = factor(quality)),
data = wine_data) +
geom_histogram(binwidth = 0.1)
```
So here we see how quality os distributed across total acidity. It seems that better rated wines are spread out more in the right handed skew. And that wines that are good or bad tend to stay in the lower acid levels. I will not though that great wines can be found at all acid levels. So perhaps bad wines almost always have lower acidity levels, where as good wines tend to have a bit higher acidity levels. Perhaps we can say that acid levels explain a chunk of the variability we see i nred wine quality. Lets look at citri, and volatile acid leveles next!

```{r citric acids with quiality, echo=FALSE}

ggplot(aes(x = citric.acid, color = factor(quality)),
data = wine_data) +
geom_histogram(binwidth = 0.01)

```
There seems to be a hot spot for poorly rated wines around the 0.00 - 0.10 citric acid range. This in a way supports the prevoious claim about acids and quality. Lets look at volitile acids.

```{r volatile acids with quiality, echo=FALSE}

ggplot(aes(x = volatile.acidity, color = factor(quality)),
data = wine_data) +
geom_histogram(binwidth = 0.01)

```
As expected the higher the volaile acids the poorer the wine on average. There seems to be a negative correlation between citric acids and volatile acids. 

#creat a heat map matrix next
```{r heastmap, echo=FALSE}
#qplot(x=wine_data$pH, y=wine_data$quality, data=melt(cor(wine_data)), fill=value, geom="tile")

#ggplot(data = wine_data, aes(x=pH, y=quality, fill=value)) + 
#  geom_tile()
cormat <- round(cor(wine_data),2)
head(cormat)
tail(cormat)


melted_cormat <- melt(cormat)
head(melted_cormat)
tail(melted_cormat)

ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()

```
















## Header
```{r tester, echo=FALSE}
#qplot(wine_data$fixed.acidity, geom="histogram")
```
 


## Header
```{r simple scatter plots, echo=FALSE}

p1 <- qplot(x = quality, y = fixed.acidity,  data = wine_data, alpha = 0.05)
p2 <- qplot(x = quality, y = volatile.acidity, data = wine_data, alpha = 0.05)
p3 <- qplot(x = quality, y = citric.acid, data = wine_data, alpha = 0.05)
p4 <- qplot(x = quality, y = residual.sugar, data = wine_data, alpha = 0.05)
p5 <- qplot(x = quality, y = free.sulfur.dioxide, data = wine_data, alpha = 0.05)
p6 <- qplot(x = quality, y = total.sulfur.dioxide, data = wine_data, alpha = 0.05)
p7 <- qplot(x = quality, y = density, data = wine_data, alpha = 0.05)
p8 <- qplot(x = quality, y = pH, data = wine_data, alpha = 0.05)
p9 <- qplot(x = quality, y = sulphates, data = wine_data, alpha = 0.05)
p10 <- qplot(x = quality, y = alcohol, data = wine_data, alpha = 0.05)
p11 <- qplot(x = quality, y = chlorides, data = wine_data, alpha = 0.05)

grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, ncol = 3)
```


## Header
```{r title, echo=FALSE}
# Code:
```







## Final Plots
```{r final plots, echo=FALSE}
# Final plot goes here, must be 3 and show a pattern
plot(pressure)
```

## Reflection
```{r reflection, echo=FALSE}
#Reflection goes here...
```
